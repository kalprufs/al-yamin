<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ú©Ù„Ø§Ø³</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap');
        
        @font-face {
            font-family: 'AbarLowFaNum';
            src: url('./fonts/AbarLowFaNum-Regular.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'AbarLowFaNum', 'Vazirmatn', 'Tahoma', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #667eea 100%);
            min-height: 100vh;
            direction: rtl;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            position: relative;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
            z-index: -1;
        }
        
        .header h1 {
            font-size: 3em;
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #fff, #f0f8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            font-size: 1.2em;
            font-weight: 300;
            opacity: 0.9;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.1),
                0 0 0 1px rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 40px;
            border-bottom: none;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 20px;
            padding: 8px;
            position: relative;
        }
        
        .tabs::before {
            content: '';
            position: absolute;
            top: 8px;
            right: 8px;
            width: calc(25% - 8px);
            height: calc(100% - 16px);
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 15px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transform: translateX(calc(var(--active-tab, 0) * -100%));
        }
        
        .tab {
            flex: 1;
            padding: 18px 25px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            font-family: inherit;
            border-radius: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #666;
            position: relative;
            z-index: 2;
        }
        
        .tab.active {
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        .tab:hover:not(.active) {
            color: #667eea;
            transform: translateY(-2px);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        .tab-content h2 {
            font-size: 2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 30px;
            position: relative;
            padding-bottom: 15px;
        }
        
        .tab-content h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        .form-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 15px;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e3f2fd;
            border-radius: 15px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 
                0 0 0 4px rgba(102, 126, 234, 0.1),
                0 10px 25px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            font-family: inherit;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(40, 167, 69, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #e91e63);
            color: white;
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.3);
        }
        
        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(220, 53, 69, 0.4);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #6f42c1);
            color: white;
            box-shadow: 0 8px 20px rgba(23, 162, 184, 0.3);
        }
        
        .btn-info:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(23, 162, 184, 0.4);
        }
        
        .sessions-list, .students-list {
            margin-top: 30px;
        }
        
        .session-item, .student-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.9));
            backdrop-filter: blur(10px);
            padding: 25px;
            margin: 20px 0;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.1),
                inset 0 1px 0 rgba(255,255,255,0.5);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .session-item::before, .student-item::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 0 20px 20px 0;
        }
        
        .session-item:hover, .student-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.15),
                inset 0 1px 0 rgba(255,255,255,0.5);
        }
        
        .session-header, .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .session-title, .student-name {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .session-item p, .student-item p {
            color: #5a6c7d;
            line-height: 1.6;
            margin: 8px 0;
        }
        
        .session-item p strong, .student-item p strong {
            color: #2c3e50;
            font-weight: 600;
        }
        
        .attendance-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .attendance-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.95));
            backdrop-filter: blur(15px);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .attendance-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .attendance-item input[type="checkbox"] {
            margin-left: 15px;
            transform: scale(1.3);
            accent-color: #667eea;
        }
        
        .student-name-clickable {
            cursor: pointer;
            color: #667eea;
            font-weight: 500;
            text-decoration: none;
            flex-grow: 1;
            transition: all 0.3s ease;
        }
        
        .student-name-clickable:hover {
            color: #5a6fd8;
            text-shadow: 0 1px 3px rgba(102, 126, 234, 0.3);
        }
        
        .score-badge {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 15px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.95));
            backdrop-filter: blur(20px);
            margin: 2% auto;
            padding: 40px;
            border-radius: 25px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.2),
                0 0 0 1px rgba(255,255,255,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            animation: modalSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes modalSlideIn {
            from { 
                opacity: 0; 
                transform: translateY(-50px) scale(0.95);
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1);
            }
        }
        
        .close {
            position: absolute;
            left: 25px;
            top: 25px;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px);
        }
        
        .close:hover {
            color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
            transform: rotate(90deg);
        }
        
        .modal h2 {
            margin-bottom: 35px;
            color: #2c3e50;
            font-size: 2.2em;
            font-weight: 700;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
            background: linear-gradient(135deg, #2c3e50, #667eea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 12px 16px;
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }
        
        .checkbox-group:hover {
            background: rgba(255,255,255,0.8);
            transform: translateX(-3px);
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-left: 12px;
            transform: scale(1.2);
            accent-color: #667eea;
        }
        
        .checkbox-group label {
            font-weight: 500;
            color: #2c3e50;
            cursor: pointer;
            flex-grow: 1;
        }
        
        .dynamic-list {
            border: 2px solid rgba(102, 126, 234, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            background: rgba(255,255,255,0.4);
            backdrop-filter: blur(10px);
        }
        
        .dynamic-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        
        .dynamic-item input {
            flex: 1;
            margin-left: 12px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .score-display {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 20px;
            font-weight: 700;
            margin: 25px 0;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        .export-section {
            text-align: center;
            margin: 40px 0;
            padding: 30px;
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.9));
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .export-section h3 {
            font-size: 1.8em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            pointer-events: none;
        }
        
        .stat-card:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
        }
        
        .stat-number {
            font-size: 2.8em;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }
        
        .stat-label {
            font-size: 1em;
            font-weight: 500;
            margin-top: 8px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .empty-state {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 60px 20px;
            background: rgba(255,255,255,0.5);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 2px dashed rgba(153,153,153,0.3);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a42a8);
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .main-content {
                padding: 25px 20px;
                border-radius: 20px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                min-width: calc(50% - 8px);
                margin: 4px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .attendance-list {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ Ú©Ù„Ø§Ø³</h1>
            <p>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù…Ù„ Ø¬Ù„Ø³Ø§ØªØŒ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù† Ùˆ Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ</p>
        </div>
        
        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('sessions')">Ø¬Ù„Ø³Ø§Øª</button>
                <button class="tab" onclick="showTab('students')">Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù†</button>
                <button class="tab" onclick="showTab('attendance')">Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</button>
                <button class="tab" onclick="showTab('reports')">Ú¯Ø²Ø§Ø±Ø´Ø§Øª</button>
            </div>
            
            <!-- Sessions Tab -->
            <div id="sessions" class="tab-content active">
                <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ø¬Ù„Ø³Ø§Øª</h2>
                <form id="sessionForm">
                    <div class="form-group">
                        <label>Ø¹Ù†ÙˆØ§Ù† Ø¬Ù„Ø³Ù‡:</label>
                        <input type="text" id="sessionTitle" required>
                    </div>
                    <div class="form-group">
                        <label>ØªØ§Ø±ÛŒØ® Ø¬Ù„Ø³Ù‡:</label>
                        <input type="date" id="sessionDate" required>
                    </div>
                    <div class="form-group">
                        <label>ØªÙˆØ¶ÛŒØ­Ø§Øª:</label>
                        <textarea id="sessionDescription" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Ø§ÙØ²ÙˆØ¯Ù† Ø¬Ù„Ø³Ù‡</button>
                </form>
                
                <div class="sessions-list" id="sessionsList"></div>
            </div>
            
            <!-- Students Tab -->
            <div id="students" class="tab-content">
                <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù†</h2>
                <form id="studentForm">
                    <div class="form-group">
                        <label>Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ:</label>
                        <input type="text" id="studentName" required>
                    </div>
                    <div class="form-group">
                        <label>ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©Ù„ÛŒ:</label>
                        <textarea id="studentNotes" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ù†Ø´Ø¬Ùˆ</button>
                </form>
                
                <div class="students-list" id="studentsList"></div>
            </div>
            
            <!-- Attendance Tab -->
            <div id="attendance" class="tab-content">
                <h2>Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</h2>
                <div id="attendanceContent"></div>
            </div>
            
            <!-- Reports Tab -->
            <div id="reports" class="tab-content">
                <h2>Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ùˆ Ø¢Ù…Ø§Ø±</h2>
                <div class="stats-grid" id="statsGrid"></div>
                <div class="export-section">
                    <h3>ğŸ“Š Ø®Ø±ÙˆØ¬ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</h3>
                    <p style="margin-bottom: 20px; color: #666;">ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ø¯Ø± Ù‚Ø§Ù„Ø¨ ÙØ§ÛŒÙ„ Excel Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯</p>
                    <button onclick="exportToExcel()" class="btn btn-success">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Excel</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Student Details Modal -->
    <div id="studentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø§Ù†Ø´Ø¬Ùˆ</h2>
            <form id="studentDetailsForm">
                <input type="hidden" id="modalStudentId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ:</label>
                        <input type="text" id="modalStudentName" readonly>
                    </div>
                    <div class="form-group">
                        <label>Ø´Ù‡Ø± Ù…Ø­Ù„ Ø²Ù†Ø¯Ú¯ÛŒ:</label>
                        <input type="text" id="modalCity">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Ø±Ø´ØªÙ‡ Ø§ØµÙ„ÛŒ:</label>
                        <input type="text" id="modalMajor">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ø´ØªÙ‡ ÙØ±Ø¹ÛŒ:</label>
                        <input type="text" id="modalMinor">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡â€ŒØ´Ø¯Ù‡:</label>
                    <div class="dynamic-list" id="booksList">
                        <button type="button" onclick="addBook()" class="btn btn-info">+ Ø§ÙØ²ÙˆØ¯Ù† Ú©ØªØ§Ø¨</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ÙÛŒÙ„Ù…â€ŒÙ‡Ø§ Ùˆ Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØ¯Ù‡â€ŒØ´Ø¯Ù‡:</label>
                    <div class="dynamic-list" id="moviesList">
                        <button type="button" onclick="addMovie()" class="btn btn-info">+ Ø§ÙØ²ÙˆØ¯Ù† ÙÛŒÙ„Ù…/Ø³Ø±ÛŒØ§Ù„</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ÙˆØ¶Ø¹ÛŒØª Ø§Ù…ØªÛŒØ§Ø²Ø§Øª Ø§Ø¶Ø§ÙÛŒ:</label>
                    <div class="checkbox-group">
                        <label>Ø¯Ø§Ø´ØªÙ† Ø´ØºÙ„</label>
                        <input type="checkbox" id="modalHasJob">
                    </div>
                    <div class="checkbox-group">
                        <label>Ù…ØªØ£Ù‡Ù„</label>
                        <input type="checkbox" id="modalIsMarried">
                    </div>
                    <div class="checkbox-group">
                        <label>Ø¯Ø§Ø´ØªÙ† ÙØ±Ø²Ù†Ø¯</label>
                        <input type="checkbox" id="modalHasChild">
                    </div>
                    <div class="checkbox-group">
                        <label>Ø­Ø¶ÙˆØ± Ø¯Ø± Ø­Ù„Ù‚Ù‡ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù…Ø·Ù‡Ø±ÛŒ</label>
                        <input type="checkbox" id="modalMotahhariStudy">
                    </div>
                    <div class="checkbox-group">
                        <label>Ø¯Ø§Ø´ØªÙ† Ù…Ù‚Ø§Ù… ÛŒØ§ Ù‚Ù‡Ø±Ù…Ø§Ù†ÛŒ</label>
                        <input type="checkbox" id="modalHasAchievement">
                    </div>
                    <div class="checkbox-group">
                        <label>Ø´Ø±Ú©Øª Ø¯Ø± Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡</label>
                        <input type="checkbox" id="modalExtraClasses">
                    </div>
                    <div class="checkbox-group">
                        <label>Ù†ÙˆØ´ØªÙ† Ø¬Ø²ÙˆÙ‡</label>
                        <input type="checkbox" id="modalWritesNotes">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Ù…ÙˆØ§Ø±Ø¯ Ú©Ø³Ø± Ø§Ù…ØªÛŒØ§Ø²:</label>
                    <div class="checkbox-group">
                        <label>Ø§Ù†Ø¬Ø§Ù… Ù†Ø¯Ø§Ø¯Ù† ØªÚ©Ø§Ù„ÛŒÙ</label>
                        <input type="checkbox" id="modalNoHomework">
                    </div>
                    <div class="checkbox-group">
                        <label>Ù†Ù†ÙˆØ´ØªÙ† Ø¬Ø²ÙˆÙ‡ Ø¯Ø± Ú©Ù„Ø§Ø³</label>
                        <input type="checkbox" id="modalNoClassNotes">
                    </div>
                    <div class="checkbox-group">
                        <label>ØºÛŒØ¨Øª Ø¯Ø± Ú©Ù„Ø§Ø³</label>
                        <input type="checkbox" id="modalAbsent">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>ØªØ£Ø®ÛŒØ±Ø§Øª (Ø¯Ù‚ÛŒÙ‚Ù‡):</label>
                    <input type="number" id="modalDelay" min="0">
                </div>
                
                <div class="score-display" id="modalScore">
                    Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„: 0
                </div>
                
                <button type="button" onclick="saveStudentDetails()" class="btn btn-success">Ø°Ø®ÛŒØ±Ù‡</button>
            </form>
        </div>
    </div>

    <script>
        // Data storage
        let sessions = [];
        let students = [];
        let attendance = {};
        let studentDetails = {};
        
        // Score configuration
        const scoreConfig = {
            hasJob: 5,
            isMarried: 3,
            hasChild: 5,
            motahhariStudy: 7,
            hasAchievement: 10,
            extraClasses: 5,
            writesNotes: 3,
            book: 2, // per book
            movie: 1, // per movie
            noHomework: -5,
            noClassNotes: -3,
            absent: -10,
            delay: -0.5 // per minute
        };
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            renderSessions();
            renderStudents();
            renderAttendance();
            renderStats();
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('sessionDate').value = today;
            
            // Form submissions
            document.getElementById('sessionForm').addEventListener('submit', addSession);
            document.getElementById('studentForm').addEventListener('submit', addStudent);
            
            // Initialize tab indicator position
            document.querySelector('.tabs').style.setProperty('--active-tab', 0);
            
            // Add event listeners to modal for real-time score updates
            setTimeout(() => {
                const modal = document.getElementById('studentModal');
                if (modal) {
                    modal.addEventListener('change', updateModalScore);
                    modal.addEventListener('input', updateModalScore);
                }
            }, 1000);
        });
        
        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Find the clicked tab and make it active
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach((tab, index) => {
                if (tab.onclick && tab.onclick.toString().includes(tabName)) {
                    tab.classList.add('active');
                    // Update CSS variable for tab indicator animation
                    document.querySelector('.tabs').style.setProperty('--active-tab', index);
                }
            });
            
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'reports') {
                renderStats();
            }
        }
        
        // Session management
        function addSession(e) {
            e.preventDefault();
            const title = document.getElementById('sessionTitle').value;
            const date = document.getElementById('sessionDate').value;
            const description = document.getElementById('sessionDescription').value;
            
            const newSession = {
                id: Date.now(),
                title,
                date,
                description,
                createdAt: new Date().toISOString()
            };
            
            sessions.push(newSession);
            
            // Initialize attendance for this session
            attendance[newSession.id] = {};
            
            saveData();
            renderSessions();
            renderAttendance();
            
            // Clear form
            document.getElementById('sessionForm').reset();
            document.getElementById('sessionDate').value = new Date().toISOString().split('T')[0];
        }
        
        function editSession(id) {
            const session = sessions.find(s => s.id === id);
            if (session) {
                document.getElementById('sessionTitle').value = session.title;
                document.getElementById('sessionDate').value = session.date;
                document.getElementById('sessionDescription').value = session.description;
                
                deleteSession(id);
            }
        }
        
        function deleteSession(id) {
            sessions = sessions.filter(s => s.id !== id);
            delete attendance[id];
            saveData();
            renderSessions();
            renderAttendance();
        }
        
        // Student management
        function addStudent(e) {
            e.preventDefault();
            const name = document.getElementById('studentName').value;
            const notes = document.getElementById('studentNotes').value;
            
            const newStudent = {
                id: Date.now(),
                name,
                notes,
                createdAt: new Date().toISOString()
            };
            
            students.push(newStudent);
            
            // Initialize student details
            studentDetails[newStudent.id] = {
                city: '',
                major: '',
                minor: '',
                books: [],
                movies: [],
                hasJob: false,
                isMarried: false,
                hasChild: false,
                motahhariStudy: false,
                hasAchievement: false,
                extraClasses: false,
                writesNotes: false,
                noHomework: false,
                noClassNotes: false,
                absent: false,
                delay: 0
            };
            
            saveData();
            renderStudents();
            renderAttendance();
            
            // Clear form
            document.getElementById('studentForm').reset();
        }
        
        function editStudent(id) {
            const student = students.find(s => s.id === id);
            if (student) {
                document.getElementById('studentName').value = student.name;
                document.getElementById('studentNotes').value = student.notes;
                
                deleteStudent(id);
            }
        }
        
        function deleteStudent(id) {
            students = students.filter(s => s.id !== id);
            delete studentDetails[id];
            
            // Remove from all attendance records
            Object.keys(attendance).forEach(sessionId => {
                delete attendance[sessionId][id];
            });
            
            saveData();
            renderStudents();
            renderAttendance();
        }
        
        // Attendance management
        function updateAttendance(sessionId, studentId, present) {
            if (!attendance[sessionId]) {
                attendance[sessionId] = {};
            }
            attendance[sessionId][studentId] = present;
            saveData();
        }
        
        // Student details modal
        function openStudentModal(studentId) {
            const student = students.find(s => s.id === studentId);
            const details = studentDetails[studentId] || {};
            
            document.getElementById('modalStudentId').value = studentId;
            document.getElementById('modalStudentName').value = student.name;
            document.getElementById('modalCity').value = details.city || '';
            document.getElementById('modalMajor').value = details.major || '';
            document.getElementById('modalMinor').value = details.minor || '';
            document.getElementById('modalDelay').value = details.delay || 0;
            
            // Set checkboxes
            document.getElementById('modalHasJob').checked = details.hasJob || false;
            document.getElementById('modalIsMarried').checked = details.isMarried || false;
            document.getElementById('modalHasChild').checked = details.hasChild || false;
            document.getElementById('modalMotahhariStudy').checked = details.motahhariStudy || false;
            document.getElementById('modalHasAchievement').checked = details.hasAchievement || false;
            document.getElementById('modalExtraClasses').checked = details.extraClasses || false;
            document.getElementById('modalWritesNotes').checked = details.writesNotes || false;
            document.getElementById('modalNoHomework').checked = details.noHomework || false;
            document.getElementById('modalNoClassNotes').checked = details.noClassNotes || false;
            document.getElementById('modalAbsent').checked = details.absent || false;
            
            // Render books and movies
            renderBooks(details.books || []);
            renderMovies(details.movies || []);
            
            // Calculate and display score
            updateModalScore();

            // Count absences for this student
            let absenceCount = 0;
            Object.values(attendance).forEach(sessionAttendance => {
                if (sessionAttendance && sessionAttendance[studentId] === false) {
                    absenceCount++;
                }
            });
            // Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øª Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† ÙØ±Ù…
            let absenceDiv = document.getElementById('modalAbsenceCount');
            if (!absenceDiv) {
                absenceDiv = document.createElement('div');
                absenceDiv.id = 'modalAbsenceCount';
                absenceDiv.style = 'margin: 20px 0; font-weight: bold; color: #dc3545; font-size: 18px;';
                document.getElementById('studentDetailsForm').appendChild(absenceDiv);
            }
            absenceDiv.innerHTML = `ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øª Ø¯Ø± Ø¬Ù„Ø³Ø§Øª: ${absenceCount}`;

            document.getElementById('studentModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('studentModal').style.display = 'none';
        }
        
        function saveStudentDetails() {
            const studentId = parseInt(document.getElementById('modalStudentId').value);
            
            const details = {
                city: document.getElementById('modalCity').value,
                major: document.getElementById('modalMajor').value,
                minor: document.getElementById('modalMinor').value,
                delay: parseInt(document.getElementById('modalDelay').value) || 0,
                hasJob: document.getElementById('modalHasJob').checked,
                isMarried: document.getElementById('modalIsMarried').checked,
                hasChild: document.getElementById('modalHasChild').checked,
                motahhariStudy: document.getElementById('modalMotahhariStudy').checked,
                hasAchievement: document.getElementById('modalHasAchievement').checked,
                extraClasses: document.getElementById('modalExtraClasses').checked,
                writesNotes: document.getElementById('modalWritesNotes').checked,
                noHomework: document.getElementById('modalNoHomework').checked,
                noClassNotes: document.getElementById('modalNoClassNotes').checked,
                absent: document.getElementById('modalAbsent').checked,
                books: getCurrentBooks(),
                movies: getCurrentMovies()
            };
            
            studentDetails[studentId] = details;
            saveData();
            closeModal();
        }
        
        // Dynamic lists for books and movies
        function addBook() {
            const container = document.getElementById('booksList');
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `
                <input type="text" placeholder="Ù†Ø§Ù… Ú©ØªØ§Ø¨" class="book-name">
                <input type="text" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª" class="book-description">
                <button type="button" onclick="this.parentElement.remove(); updateModalScore();" class="btn btn-danger">Ø­Ø°Ù</button>
            `;
            container.insertBefore(div, container.lastElementChild);
            updateModalScore();
        }
        
        function addMovie() {
            const container = document.getElementById('moviesList');
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `
                <input type="text" placeholder="Ù†Ø§Ù… ÙÛŒÙ„Ù…/Ø³Ø±ÛŒØ§Ù„" class="movie-name">
                <input type="text" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª" class="movie-description">
                <button type="button" onclick="this.parentElement.remove(); updateModalScore();" class="btn btn-danger">Ø­Ø°Ù</button>
            `;
            container.insertBefore(div, container.lastElementChild);
            updateModalScore();
        }
        
        function renderBooks(books) {
            const container = document.getElementById('booksList');
            container.innerHTML = '<button type="button" onclick="addBook()" class="btn btn-info">+ Ø§ÙØ²ÙˆØ¯Ù† Ú©ØªØ§Ø¨</button>';
            
            books.forEach(book => {
                const div = document.createElement('div');
                div.className = 'dynamic-item';
                div.innerHTML = `
                    <input type="text" placeholder="Ù†Ø§Ù… Ú©ØªØ§Ø¨" class="book-name" value="${book.name}">
                    <input type="text" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª" class="book-description" value="${book.description}">
                    <button type="button" onclick="this.parentElement.remove(); updateModalScore();" class="btn btn-danger">Ø­Ø°Ù</button>
                `;
                container.insertBefore(div, container.lastElementChild);
            });
        }
        
        function renderMovies(movies) {
            const container = document.getElementById('moviesList');
            container.innerHTML = '<button type="button" onclick="addMovie()" class="btn btn-info">+ Ø§ÙØ²ÙˆØ¯Ù† ÙÛŒÙ„Ù…/Ø³Ø±ÛŒØ§Ù„</button>';
            
            movies.forEach(movie => {
                const div = document.createElement('div');
                div.className = 'dynamic-item';
                div.innerHTML = `
                    <input type="text" placeholder="Ù†Ø§Ù… ÙÛŒÙ„Ù…/Ø³Ø±ÛŒØ§Ù„" class="movie-name" value="${movie.name}">
                    <input type="text" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª" class="movie-description" value="${movie.description}">
                    <button type="button" onclick="this.parentElement.remove(); updateModalScore();" class="btn btn-danger">Ø­Ø°Ù</button>
                `;
                container.insertBefore(div, container.lastElementChild);
            });
        }
        
        function getCurrentBooks() {
            const books = [];
            document.querySelectorAll('#booksList .dynamic-item').forEach(item => {
                const name = item.querySelector('.book-name').value;
                const description = item.querySelector('.book-description').value;
                if (name.trim()) {
                    books.push({ name: name.trim(), description: description.trim() });
                }
            });
            return books;
        }
        
        function getCurrentMovies() {
            const movies = [];
            document.querySelectorAll('#moviesList .dynamic-item').forEach(item => {
                const name = item.querySelector('.movie-name').value;
                const description = item.querySelector('.movie-description').value;
                if (name.trim()) {
                    movies.push({ name: name.trim(), description: description.trim() });
                }
            });
            return movies;
        }
        
        // Score calculation
        function calculateStudentScore(studentId) {
            const details = studentDetails[studentId];
            if (!details) return 0;
            
            let score = 0;
            
            // Positive scores
            if (details.hasJob) score += scoreConfig.hasJob;
            if (details.isMarried) score += scoreConfig.isMarried;
            if (details.hasChild) score += scoreConfig.hasChild;
            if (details.motahhariStudy) score += scoreConfig.motahhariStudy;
            if (details.hasAchievement) score += scoreConfig.hasAchievement;
            if (details.extraClasses) score += scoreConfig.extraClasses;
            if (details.writesNotes) score += scoreConfig.writesNotes;
            
            // Books and movies
            score += (details.books || []).length * scoreConfig.book;
            score += (details.movies || []).length * scoreConfig.movie;
            
            // Negative scores
            if (details.noHomework) score += scoreConfig.noHomework;
            if (details.noClassNotes) score += scoreConfig.noClassNotes;
            if (details.absent) score += scoreConfig.absent;
            score += (details.delay || 0) * scoreConfig.delay;
            
            return Math.round(score * 10) / 10;
        }
        
        function updateModalScore() {
            // Add event listeners to checkboxes and inputs to update score in real-time
            setTimeout(() => {
                const studentId = parseInt(document.getElementById('modalStudentId').value);
                if (studentId) {
                    // Create temporary details object for calculation
                    const tempDetails = {
                        hasJob: document.getElementById('modalHasJob').checked,
                        isMarried: document.getElementById('modalIsMarried').checked,
                        hasChild: document.getElementById('modalHasChild').checked,
                        motahhariStudy: document.getElementById('modalMotahhariStudy').checked,
                        hasAchievement: document.getElementById('modalHasAchievement').checked,
                        extraClasses: document.getElementById('modalExtraClasses').checked,
                        writesNotes: document.getElementById('modalWritesNotes').checked,
                        noHomework: document.getElementById('modalNoHomework').checked,
                        noClassNotes: document.getElementById('modalNoClassNotes').checked,
                        absent: document.getElementById('modalAbsent').checked,
                        delay: parseInt(document.getElementById('modalDelay').value) || 0,
                        books: getCurrentBooks(),
                        movies: getCurrentMovies()
                    };
                    
                    let score = 0;
                    if (tempDetails.hasJob) score += scoreConfig.hasJob;
                    if (tempDetails.isMarried) score += scoreConfig.isMarried;
                    if (tempDetails.hasChild) score += scoreConfig.hasChild;
                    if (tempDetails.motahhariStudy) score += scoreConfig.motahhariStudy;
                    if (tempDetails.hasAchievement) score += scoreConfig.hasAchievement;
                    if (tempDetails.extraClasses) score += scoreConfig.extraClasses;
                    if (tempDetails.writesNotes) score += scoreConfig.writesNotes;
                    score += tempDetails.books.length * scoreConfig.book;
                    score += tempDetails.movies.length * scoreConfig.movie;
                    if (tempDetails.noHomework) score += scoreConfig.noHomework;
                    if (tempDetails.noClassNotes) score += scoreConfig.noClassNotes;
                    if (tempDetails.absent) score += scoreConfig.absent;
                    score += tempDetails.delay * scoreConfig.delay;
                    
                    document.getElementById('modalScore').innerHTML = `Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„: ${Math.round(score * 10) / 10}`;
                }
            }, 100);
        }
        
        // Add event listeners for real-time score update - Remove duplicate
        // (This section was moved to DOMContentLoaded above)
        
        // Render functions
        function renderSessions() {
            const container = document.getElementById('sessionsList');
            if (sessions.length === 0) {
                container.innerHTML = '<div class="empty-state">ğŸ“ Ù‡Ù†ÙˆØ² Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª<br><small>Ø§ÙˆÙ„ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯</small></div>';
                return;
            }
            
            container.innerHTML = sessions.map(session => `
                <div class="session-item">
                    <div class="session-header">
                        <div class="session-title">${session.title}</div>
                        <div>
                            <button onclick="editSession(${session.id})" class="btn btn-info">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button onclick="deleteSession(${session.id})" class="btn btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>
                    </div>
                    <p><strong>ğŸ“… ØªØ§Ø±ÛŒØ®:</strong> ${new Date(session.date).toLocaleDateString('fa-IR')}</p>
                    <p><strong>ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª:</strong> ${session.description || 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª'}</p>
                </div>
            `).join('');
        }
        
        function renderStudents() {
            const container = document.getElementById('studentsList');
            if (students.length === 0) {
                container.innerHTML = '<div class="empty-state">ğŸ‘¥ Ù‡Ù†ÙˆØ² Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª<br><small>Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯</small></div>';
                return;
            }
            
            container.innerHTML = students.map(student => {
                const score = calculateStudentScore(student.id);
                return `
                    <div class="student-item">
                        <div class="student-header">
                            <div class="student-name">ğŸ‘¤ ${student.name}</div>
                            <div>
                                <span class="score-badge">â­ Ø§Ù…ØªÛŒØ§Ø²: ${score}</span>
                                <button onclick="editStudent(${student.id})" class="btn btn-info">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
                                <button onclick="deleteStudent(${student.id})" class="btn btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <p><strong>ğŸ“‹ ØªÙˆØ¶ÛŒØ­Ø§Øª:</strong> ${student.notes || 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­Ø§Øª'}</p>
                    </div>
                `;
            }).join('');
        }
        
        function renderAttendance() {
            const container = document.getElementById('attendanceContent');
            
            if (sessions.length === 0 || students.length === 0) {
                container.innerHTML = '<div class="empty-state">ğŸ“Š Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨ØŒ Ø§Ø¨ØªØ¯Ø§ Ø¬Ù„Ø³Ù‡ Ùˆ Ø¯Ø§Ù†Ø´Ø¬Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯<br><small>Ø¨Ù‡ ØªØ¨â€ŒÙ‡Ø§ÛŒ Ø¬Ù„Ø³Ø§Øª Ùˆ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù† Ø¨Ø±ÙˆÛŒØ¯</small></div>';
                return;
            }
            
            container.innerHTML = sessions.map(session => `
                <div class="session-item">
                    <div class="session-header">
                        <div class="session-title">ğŸ“š ${session.title}</div>
                        <div style="font-size: 14px; color: #666;">ğŸ“… ${new Date(session.date).toLocaleDateString('fa-IR')}</div>
                    </div>
                    <div class="attendance-list">
                        ${students.map(student => `
                            <div class="attendance-item">
                                <input type="checkbox" 
                                       ${attendance[session.id] && attendance[session.id][student.id] ? 'checked' : ''}
                                       onchange="updateAttendance(${session.id}, ${student.id}, this.checked)">
                                <span class="student-name-clickable" onclick="openStudentModal(${student.id})">ğŸ‘¤ ${student.name}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function renderStats() {
            const statsContainer = document.getElementById('statsGrid');
            
            if (students.length === 0) {
                statsContainer.innerHTML = '<div class="empty-state">ğŸ“ˆ Ø¢Ù…Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯<br><small>Ø§Ø¨ØªØ¯Ø§ Ø¯Ø§Ù†Ø´Ø¬Ùˆ Ùˆ Ø¬Ù„Ø³Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯</small></div>';
                return;
            }
            
            // Calculate statistics
            const totalStudents = students.length;
            const totalSessions = sessions.length;
            
            let totalAttendances = 0;
            let totalPossibleAttendances = totalStudents * totalSessions;
            
            Object.values(attendance).forEach(sessionAttendance => {
                Object.values(sessionAttendance).forEach(isPresent => {
                    if (isPresent) totalAttendances++;
                });
            });
            
            const attendanceRate = totalPossibleAttendances > 0 ? 
                Math.round((totalAttendances / totalPossibleAttendances) * 100) : 0;
            
            const averageScore = students.length > 0 ? 
                Math.round((students.reduce((sum, student) => sum + calculateStudentScore(student.id), 0) / students.length) * 10) / 10 : 0;
            
            const topStudent = students.reduce((top, student) => {
                const score = calculateStudentScore(student.id);
                return score > calculateStudentScore(top.id) ? student : top;
            }, students[0]);
            
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">ğŸ‘¥ ${totalStudents}</div>
                    <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù†</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">ğŸ“š ${totalSessions}</div>
                    <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù„Ø³Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">ğŸ“Š ${attendanceRate}%</div>
                    <div class="stat-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø­Ø¶ÙˆØ±</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">â­ ${averageScore}</div>
                    <div class="stat-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">ğŸ† ${calculateStudentScore(topStudent.id)}</div>
                    <div class="stat-label">Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø²<br><small>ğŸ‘¤ ${topStudent.name}</small></div>
                </div>
            `;
        }
        
        // Data persistence
        function saveData() {
            const data = {
                sessions,
                students,
                attendance,
                studentDetails,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('classAttendanceData', JSON.stringify(data));
        }
        
        function loadData() {
            const saved = localStorage.getItem('classAttendanceData');
            if (saved) {
                const data = JSON.parse(saved);
                sessions = data.sessions || [];
                students = data.students || [];
                attendance = data.attendance || {};
                studentDetails = data.studentDetails || {};
            }
        }
        
        // Excel export function
        function exportToExcel() {
            // Prepare data for export
            const workbook = XLSX.utils.book_new();
            
            // Sessions sheet
            const sessionsData = sessions.map(session => ({
                'Ø¹Ù†ÙˆØ§Ù† Ø¬Ù„Ø³Ù‡': session.title,
                'ØªØ§Ø±ÛŒØ®': new Date(session.date).toLocaleDateString('fa-IR'),
                'ØªÙˆØ¶ÛŒØ­Ø§Øª': session.description || '',
                'ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯': new Date(session.createdAt).toLocaleDateString('fa-IR')
            }));
            const sessionsSheet = XLSX.utils.json_to_sheet(sessionsData);
            XLSX.utils.book_append_sheet(workbook, sessionsSheet, 'Ø¬Ù„Ø³Ø§Øª');
            
            // Students sheet
            const studentsData = students.map(student => {
                const details = studentDetails[student.id] || {};
                const score = calculateStudentScore(student.id);
                
                // Ø´Ù…Ø§Ø±Ø´ ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øª (Ù‡Ø± Ø¬Ù„Ø³Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø­Ø§Ø¶Ø± Ù†Ø¨Ø§Ø´Ø¯ØŒ ØºÛŒØ¨Øª Ø§Ø³Øª)
                let absenceCount = 0;
                sessions.forEach(session => {
                    if (!attendance[session.id] || attendance[session.id][student.id] !== true) {
                        absenceCount++;
                    }
                });

                return {
                    'Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ': student.name,
                    'Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„': score,
                    'ØªØ¹Ø¯Ø§Ø¯ ØºÛŒØ¨Øª': absenceCount,
                    'Ø´Ù‡Ø±': details.city || '',
                    'Ø±Ø´ØªÙ‡ Ø§ØµÙ„ÛŒ': details.major || '',
                    'Ø±Ø´ØªÙ‡ ÙØ±Ø¹ÛŒ': details.minor || '',
                    'ØªØ£Ø®ÛŒØ± (Ø¯Ù‚ÛŒÙ‚Ù‡)': details.delay || 0,
                    'ØªØ¹Ø¯Ø§Ø¯ Ú©ØªØ§Ø¨â€ŒÙ‡Ø§': (details.books || []).length,
                    'ØªØ¹Ø¯Ø§Ø¯ ÙÛŒÙ„Ù…â€ŒÙ‡Ø§': (details.movies || []).length,
                    'Ø¯Ø§Ø±Ø§ÛŒ Ø´ØºÙ„': details.hasJob ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                    'Ù…ØªØ£Ù‡Ù„': details.isMarried ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                    'Ø¯Ø§Ø±Ø§ÛŒ ÙØ±Ø²Ù†Ø¯': details.hasChild ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                    'Ø­Ù„Ù‚Ù‡ Ù…Ø·Ù‡Ø±ÛŒ': details.motahhariStudy ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                    'Ù…Ù‚Ø§Ù…/Ù‚Ù‡Ø±Ù…Ø§Ù†ÛŒ': details.hasAchievement ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                    'Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡': details.extraClasses ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                    'Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡ Ø¬Ø²ÙˆÙ‡': details.writesNotes ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                    'Ø¹Ø¯Ù… Ø§Ù†Ø¬Ø§Ù… ØªÚ©Ø§Ù„ÛŒÙ': details.noHomework ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                    'Ø¹Ø¯Ù… Ù†ÙˆØ´ØªÙ† Ø¬Ø²ÙˆÙ‡': details.noClassNotes ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                    'ØºÛŒØ¨Øª': details.absent ? 'Ø¨Ù„Ù‡' : 'Ø®ÛŒØ±',
                    'ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©Ù„ÛŒ': student.notes || ''
                };
            });
            const studentsSheet = XLSX.utils.json_to_sheet(studentsData);
            XLSX.utils.book_append_sheet(workbook, studentsSheet, 'Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù†');
            
            // Attendance sheet
            const attendanceData = [];
            sessions.forEach(session => {
                students.forEach(student => {
                    const isPresent = attendance[session.id] && attendance[session.id][student.id];
                    attendanceData.push({
                        'Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ': student.name,
                        'Ø¹Ù†ÙˆØ§Ù† Ø¬Ù„Ø³Ù‡': session.title,
                        'ØªØ§Ø±ÛŒØ® Ø¬Ù„Ø³Ù‡': new Date(session.date).toLocaleDateString('fa-IR'),
                        'Ø­Ø¶ÙˆØ±': isPresent ? 'Ø­Ø§Ø¶Ø±' : 'ØºØ§ÛŒØ¨'
                    });
                });
            });
            const attendanceSheet = XLSX.utils.json_to_sheet(attendanceData);
            XLSX.utils.book_append_sheet(workbook, attendanceSheet, 'Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨');
            
            // Books sheet
            const booksData = [];
            students.forEach(student => {
                const details = studentDetails[student.id] || {};
                (details.books || []).forEach(book => {
                    booksData.push({
                        'Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ': student.name,
                        'Ù†Ø§Ù… Ú©ØªØ§Ø¨': book.name,
                        'ØªÙˆØ¶ÛŒØ­Ø§Øª': book.description || ''
                    });
                });
            });
            if (booksData.length > 0) {
                const booksSheet = XLSX.utils.json_to_sheet(booksData);
                XLSX.utils.book_append_sheet(workbook, booksSheet, 'Ú©ØªØ§Ø¨â€ŒÙ‡Ø§');
            }
            
            // Movies sheet
            const moviesData = [];
            students.forEach(student => {
                const details = studentDetails[student.id] || {};
                (details.movies || []).forEach(movie => {
                    moviesData.push({
                        'Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ø¬Ùˆ': student.name,
                        'Ù†Ø§Ù… ÙÛŒÙ„Ù…/Ø³Ø±ÛŒØ§Ù„': movie.name,
                        'ØªÙˆØ¶ÛŒØ­Ø§Øª': movie.description || ''
                    });
                });
            });
            if (moviesData.length > 0) {
                const moviesSheet = XLSX.utils.json_to_sheet(moviesData);
                XLSX.utils.book_append_sheet(workbook, moviesSheet, 'ÙÛŒÙ„Ù…â€ŒÙ‡Ø§ Ùˆ Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§');
            }
            
            // Download file
            const fileName = `Ú¯Ø²Ø§Ø±Ø´_Ú©Ù„Ø§Ø³_${new Date().toLocaleDateString('fa-IR').replace(/\//g, '-')}.xlsx`;
            XLSX.writeFile(workbook, fileName);
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('studentModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
